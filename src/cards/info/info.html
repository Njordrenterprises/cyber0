<!-- src/cards/info/info.html -->
<div class="card info-card"
     x-data="{ 
       messages: [],
       inputValue: '',
       cardIndex: $el.closest('.card-wrapper').dataset.index,
       cardData: null,
       async init() {
         // Get already initialized card data
         this.cardData = globalThis.cardData.info;
         await this.loadMessages();
       },
       async submitMessage() {
         if (!this.inputValue.trim()) return;
         await this.cardData.handleKvUpdate(parseInt(this.cardIndex), this.inputValue);
         this.inputValue = '';
         await this.loadMessages();
       },
       async deleteMessage(messageId) {
         await this.cardData.handleKvDelete(parseInt(this.cardIndex), messageId);
         await this.loadMessages();
       },
       async loadMessages() {
         this.messages = await this.cardData.loadCardMessages(parseInt(this.cardIndex));
         // Sort messages by timestamp in descending order (newest first)
         this.messages.sort((a, b) => b.timestamp - a.timestamp);
       }
     }"
     x-init="init()">
  <div class="info-content">
    <h1>Info Card #<span x-text="parseInt(cardIndex) + 1"></span></h1>
    
    <form @submit.prevent="submitMessage" class="input-container">
      <input type="text" 
             x-model="inputValue" 
             placeholder="Enter a message">
      <button type="submit" class="submit-btn">Submit</button>
    </form>

    <div class="message-container">
      <template x-for="message in messages" :key="message.id">
        <div class="message">
          <div class="message-text" x-text="message.text"></div>
          <div class="message-meta">
            <span class="message-time" x-text="new Date(message.timestamp).toLocaleString()"></span>
            <button class="delete-btn" @click="deleteMessage(message.id)">Ã—</button>
          </div>
        </div>
      </template>
    </div>
  </div>
</div>